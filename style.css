/* ============================================================
   PiSlider — Chladni Aesthetic Stylesheet v2.2
   Theme: Technical Dark Mode / Neumorphic Hardware Controller
   ============================================================ */

:root {
    --bg:           #121212;
    --panel:        #1b1b1b;
    --panel-light:  #252525;
    --panel-dark:   #0a0a0a;

    --text-main:  #eeeeee;
    --text-dim:   #888888;
    --text-muted: #666666;

    --accent-teal:  #00AAFF;
    --accent-red:   #FF5050;
    --accent-green: #50FF8C;
    --accent-gold:  #FFD250;

    --stop-red: #CC3333;
    --radius:   12px;
    --border:   1px solid #333333;
}

/* --- Modal overlay (folder browser) --- */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-box {
    background: var(--panel);
    border: var(--border);
    border-radius: var(--radius);
    width: min(480px, 90vw);
    max-height: 70vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
}

.modal-header {
    padding: 12px 16px;
    border-bottom: var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-footer {
    padding: 10px 16px;
    border-top: var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
}

.folder-list {
    flex: 1;
    overflow-y: auto;
    padding: 6px 0;
}

.folder-entry {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    cursor: pointer;
    font-family: monospace;
    font-size: 0.82rem;
    color: var(--text-main);
    border-bottom: 1px solid #222;
    transition: background 0.1s;
}

.folder-entry:hover  { background: #252525; }
.folder-entry .icon  { color: var(--accent-teal); font-size: 1rem; width: 16px; }
.folder-entry.is-file { color: var(--text-muted); cursor: default; }
.folder-entry.is-file:hover { background: transparent; }

/* --- Running state — grey-out sidebar controls --- */
body.running #sidebar {
    pointer-events: none;
    opacity: 0.45;
}
/* Header always active */
body.running #header {
    pointer-events: all;
    opacity: 1;
}
/* E-stop button always hot */
#stopBtn {
    pointer-events: all !important;
    opacity: 1 !important;
}

/* Latest frame / live feed switching via body class */
body.running  #mjpegFeed   { display: none !important; }
body.running  #latestFrame { display: block !important; }
body.idle     #latestFrame { display: none !important; }
body.idle     #mjpegFeed   { display: block !important; }
* { box-sizing: border-box; }

body, html {
    margin: 0; padding: 0;
    width: 100vw; height: 100vh;
    background-color: var(--bg);
    color: var(--text-main);
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* --- Header --- */
#header {
    height: 70px;
    background: var(--panel);
    border-bottom: var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    z-index: 100;
    flex-shrink: 0;
}

.title-block h1 {
    font-size: 1.3rem;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.version-tag {
    font-size: 0.65rem;
    color: var(--accent-teal);
    font-weight: bold;
}

.header-buttons { display: flex; gap: 8px; }

/* --- Main Grid --- */
#mainLayout {
    display: flex;
    flex: 1;
    overflow: hidden;
}

#sidebar {
    width: 380px;
    background: var(--panel);
    border-right: var(--border);
    padding: 15px 12px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--panel-light) var(--bg);
    flex-shrink: 0;
}

#stage {
    flex: 1;
    background: #111111;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    overflow-y: auto;
}

/* --- Group Box --- */
.group-box {
    position: relative;
    background: var(--panel);
    border: var(--border);
    border-radius: var(--radius);
    padding: 18px 12px 12px 12px;
    margin-bottom: 18px;
    box-shadow: 4px 4px 10px var(--panel-dark);
}

.group-title {
    position: absolute;
    top: -11px; left: 12px;
    background: var(--panel);
    padding: 0 8px;
    margin: 0;
    font-size: 0.72rem;
    color: var(--accent-teal);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
}

/* Sub-group headings inside panels */
.sub-group-title {
    font-size: 0.65rem;
    color: var(--accent-gold);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
    margin: 8px 0 4px 0;
    border-bottom: 1px solid #333;
    padding-bottom: 2px;
}

/* --- Form Controls --- */
.control-item {
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
}

.control-item label {
    font-size: 0.68rem;
    color: var(--text-dim);
    text-transform: uppercase;
    margin-bottom: 3px;
}

input[type="number"],
input[type="text"],
select {
    background: var(--panel-dark);
    border: 1px solid #444;
    border-radius: 4px;
    color: var(--accent-teal);
    padding: 6px 8px;
    font-family: monospace;
    font-size: 0.95rem;
    outline: none;
    width: 100%;
}

input[type="number"]:focus,
input[type="text"]:focus { border-color: var(--accent-teal); }

input[type="range"] {
    width: 100%;
    accent-color: var(--accent-teal);
    cursor: pointer;
}

.row { display: flex; gap: 8px; width: 100%; }
.half    { flex: 1; }
.quarter { flex: 0.5; }

/* --- Buttons --- */
button {
    background: #2a2a2a;
    border: 1px solid #444;
    color: var(--text-main);
    padding: 9px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.75rem;
    text-transform: uppercase;
    transition: all 0.15s;
    letter-spacing: 0.5px;
}

button:hover  { background: #333; }
button:active { transform: translateY(1px); }

.mode-btn.active {
    background: var(--accent-teal);
    color: #000;
    border-color: var(--accent-teal);
    font-weight: bold;
}

.stop-style { border-color: var(--stop-red); color: var(--stop-red); }
.stop-style:hover { background: var(--stop-red); color: white; }
.reset-style { border-color: #444; color: #666; font-size: 0.7rem; }
.reset-style:hover { border-color: var(--accent-gold); color: var(--accent-gold); }

.button-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

/* --- Relay Buttons --- */
.relay-btn {
    flex: 1;
    border-color: #555;
    font-size: 0.7rem;
}
.relay-btn.relay-active {
    background: var(--accent-gold);
    color: #000;
    border-color: var(--accent-gold);
    font-weight: bold;
}

/* --- Toggle Checkboxes --- */
.toggle-label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    color: var(--text-dim);
    cursor: pointer;
    user-select: none;
}

input[type="checkbox"] {
    accent-color: var(--accent-teal);
    width: 14px; height: 14px;
    cursor: pointer;
}

/* --- Radio Group --- */
.radio-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 2px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.8rem;
    color: var(--text-main);
    cursor: pointer;
    text-transform: none;
}

input[type="radio"] {
    accent-color: var(--accent-teal);
    cursor: pointer;
}

/* --- Nudge Buttons (Calibration) --- */
.nudge-btn {
    background: var(--panel-dark);
    border: 1px solid #444;
    color: var(--accent-teal);
    padding: 5px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.7rem;
    font-family: monospace;
    transition: all 0.12s;
    flex: 1;
    min-width: 44px;
    text-align: center;
}

.nudge-btn:hover  { background: #1a2a3a; border-color: var(--accent-teal); }
.nudge-btn:active { transform: translateY(1px); background: var(--accent-teal); color: #000; }


.collapsible-btn {
    width: 100%;
    background: var(--panel-dark);
    border: 1px solid #444;
    color: var(--accent-teal);
    font-size: 0.72rem;
    text-align: left;
    padding: 7px 10px;
    letter-spacing: 0.5px;
}

.collapsible-btn:hover { background: #1a1a1a; }

.collapsible-content {
    display: none;
    margin-top: 8px;
    padding: 8px;
    background: var(--panel-dark);
    border: 1px solid #333;
    border-radius: 4px;
}

/* --- Readout Cards --- */
.readout-card {
    background: #000;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 10px 12px;
    color: var(--accent-teal);
    font-family: 'Courier New', Courier, monospace;
    font-size: 1rem;
    text-align: center;
    box-shadow: inset 0 0 10px rgba(0,170,255,0.15);
}

/* --- Stage / Visualizer --- */
.visualizer-box {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.canvas-container {
    width: 100%;
    aspect-ratio: 4 / 3;   /* matches IMX477 native ratio — eliminates black bars */
    background: #000;
    border-radius: var(--radius);
    overflow: hidden;
    border: var(--border);
    position: relative;    /* stacking context for absolute children */
    flex-shrink: 0;
}

/* All feed images + canvas are absolute inside the container */
#mjpegFeed,
#latestFrame {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: fill;      /* fill exactly — no letterbox bars since container matches AR */
    z-index: 1;
}

/* ── Loupe Ring ────────────────────────────────────────────── */
/* Canvas overlay for loupe + motion ROI — always above feed */
#overlayCanvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 10;
}

/* ── Crosshair Reticle ────────────────────────────────────── */
#feedReticle {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 40px; height: 40px;
    pointer-events: none;
    z-index: 5;
}

/* Cross lines via pseudo-elements */
#feedReticle::before,
#feedReticle::after {
    content: '';
    position: absolute;
    background: rgba(0, 170, 255, 0.5);
}
#feedReticle::before {   /* horizontal */
    width: 40px; height: 1px;
    top: 50%; left: 0;
    transform: translateY(-50%);
}
#feedReticle::after {    /* vertical */
    width: 1px; height: 40px;
    left: 50%; top: 0;
    transform: translateX(-50%);
}

#statusLine {
    margin-top: 8px;
    font-family: monospace;
    font-size: 0.8rem;
    color: var(--accent-green);
}

#interactionArea {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 15px;
    height: 260px;
}

/* --- Joystick --- */
.joystick-box .motion-content {
    display: flex;
    align-items: center;
    gap: 25px;
}

.dial-container {
    width: 160px; height: 160px;
    position: relative;
    background: var(--panel-dark);
    border-radius: 50%;
    box-shadow: 4px 4px 10px #000, -4px -4px 10px #222;
    flex-shrink: 0;
}

.dial-inner {
    position: absolute;
    inset: 10px;
    border-radius: 50%;
    border: 1px solid #333;
}

.dial-knob {
    width: 40px; height: 40px;
    background: var(--accent-teal);
    border-radius: 50%;
    position: absolute;
    left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    cursor: grab;
    box-shadow: 0 0 15px var(--accent-teal);
}

.joystick-box .readouts {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.joystick-box .readout-card {
    text-align: left;
    font-size: 0.85rem;
    padding: 8px 10px;
}

/* --- Progress Box --- */
.progress-box { display: flex; flex-direction: column; }

.progress-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100%;
    padding-top: 8px;
}

.big-frame-num {
    font-size: 2.2rem;
    font-weight: 900;
    color: var(--accent-green);
    font-family: monospace;
}

.time-est { font-size: 0.72rem; color: var(--text-dim); margin-top: 2px; }

/* --- Guide HUD --- */
.guide-box {
    background: rgba(0,170,255,0.05);
    border-left: 3px solid var(--accent-teal);
    padding: 10px 12px;
    margin: 10px 0;
    border-radius: 4px;
}

.guide-title {
    margin: 0 0 6px 0;
    font-size: 0.72rem;
    color: var(--accent-teal);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.guide-text {
    margin: 0; padding: 0;
    list-style: none;
    font-size: 0.78rem;
    line-height: 1.5;
    color: var(--text-dim);
    font-family: monospace;
}

.guide-text b { color: var(--text-main); }

/* --- Drive quick-jump chips --- */
.drive-chip {
    background: var(--panel-light);
    border: var(--border);
    border-radius: 20px;
    color: var(--text-dim);
    font-size: 0.7rem;
    font-family: monospace;
    padding: 3px 10px;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.12s;
}
.drive-chip:hover {
    border-color: var(--accent-teal);
    color: var(--accent-teal);
    background: rgba(0,170,255,0.08);
}
.drive-chip.active {
    background: rgba(0,170,255,0.18);
    border-color: var(--accent-teal);
    color: var(--accent-teal);
}

/* --- Slider strip joystick (linear, single axis) --- */
.dial-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
}

.slider-strip-wrap {
    width: 160px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.slider-strip-label {
    font-size: 0.6rem;
    color: var(--text-dim);
    font-family: monospace;
    letter-spacing: 0.5px;
    user-select: none;
}

.slider-strip-track {
    width: 100%;
    height: 28px;
    background: var(--panel-dark);
    border: var(--border);
    border-radius: 14px;
    position: relative;
    cursor: grab;
    box-shadow: inset 2px 2px 6px #000, inset -2px -2px 6px #222;
    touch-action: none;
}

.slider-strip-knob {
    width: 28px; height: 28px;
    background: var(--accent-teal);
    border-radius: 50%;
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    cursor: grab;
    box-shadow: 0 0 10px var(--accent-teal);
    transition: box-shadow 0.1s;
    pointer-events: none;
}
.slider-strip-track:active .slider-strip-knob,
.slider-strip-track.active .slider-strip-knob {
    box-shadow: 0 0 18px var(--accent-teal), 0 0 4px #fff;
    cursor: grabbing;
}

/* --- Disk / alert banner --- */
.disk-alert-banner {
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2000;
    background: #2a0000;
    border: 2px solid var(--accent-red);
    border-radius: 10px;
    padding: 14px 24px;
    color: var(--accent-red);
    font-family: monospace;
    font-size: 0.85rem;
    text-align: center;
    box-shadow: 0 6px 30px rgba(0,0,0,0.8);
    max-width: 500px;
    animation: alertPop 0.2s ease-out;
}
.disk-alert-banner button {
    margin-top: 10px;
    display: block;
    width: 100%;
    background: var(--panel-light);
    border: 1px solid var(--accent-red);
    border-radius: 6px;
    color: var(--text-dim);
    padding: 6px;
    cursor: pointer;
    font-size: 0.75rem;
}
.disk-alert-banner button:hover { background: #3a0000; color: #fff; }

@keyframes alertPop {
    from { opacity: 0; transform: translateX(-50%) scale(0.92); }
    to   { opacity: 1; transform: translateX(-50%) scale(1); }
}

/* Disk free label colouring */
.disk-ok   { color: var(--accent-teal); }
.disk-warn { color: var(--accent-gold); }
.disk-crit { color: var(--accent-red); }

/* --- Footer --- */
#footer {
    height: 36px;
    background: var(--panel-dark);
    border-top: var(--border);
    display: flex;
    align-items: center;
    padding: 0 20px;
    flex-shrink: 0;
}

#debugOverlay {
    font-family: monospace;
    font-size: 0.72rem;
    color: var(--text-muted);
}
